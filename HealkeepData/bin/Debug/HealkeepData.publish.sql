/*
Deployment script for Healkeep_DB

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "Healkeep_DB"
:setvar DefaultFilePrefix "Healkeep_DB"
:setvar DefaultDataPath ""
:setvar DefaultLogPath ""

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
USE [$(DatabaseName)];


GO
IF EXISTS (SELECT 1
           FROM   [sys].[databases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET ALLOW_SNAPSHOT_ISOLATION OFF;
    END


GO
USE [$(DatabaseName)];


GO
PRINT N'Creating [dbo].[AspNetRoles]...';


GO
CREATE TABLE [dbo].[AspNetRoles] (
    [Id]   NVARCHAR (128) NOT NULL,
    [Name] NVARCHAR (256) NOT NULL,
    CONSTRAINT [PK_AspNetRoles] PRIMARY KEY CLUSTERED ([Id] ASC)
);


GO
PRINT N'Creating [dbo].[AspNetUserClaims]...';


GO
CREATE TABLE [dbo].[AspNetUserClaims] (
    [Id]         INT            IDENTITY (1, 1) NOT NULL,
    [UserId]     NVARCHAR (128) NOT NULL,
    [ClaimType]  NVARCHAR (MAX) NULL,
    [ClaimValue] NVARCHAR (MAX) NULL,
    CONSTRAINT [PK_AspNetUserClaims] PRIMARY KEY CLUSTERED ([Id] ASC)
);


GO
PRINT N'Creating [dbo].[AspNetUserClaims].[IX_FK_dbo_AspNetUserClaims_dbo_AspNetUsers_UserId]...';


GO
CREATE NONCLUSTERED INDEX [IX_FK_dbo_AspNetUserClaims_dbo_AspNetUsers_UserId]
    ON [dbo].[AspNetUserClaims]([UserId] ASC);


GO
PRINT N'Creating [dbo].[AspNetUserComments]...';


GO
CREATE TABLE [dbo].[AspNetUserComments] (
    [AspNetUserCommentID] BIGINT         IDENTITY (1, 1) NOT NULL,
    [CheckedUp]           BIT            NULL,
    [AspNetUserID]        NVARCHAR (128) NULL,
    [CommentID]           BIGINT         NULL,
    [NaturalTreatmentID]  BIGINT         NULL,
    [CheckedDown]         BIT            NULL,
    CONSTRAINT [PK_AspNetUserComments] PRIMARY KEY CLUSTERED ([AspNetUserCommentID] ASC)
);


GO
PRINT N'Creating [dbo].[AspNetUserLogins]...';


GO
CREATE TABLE [dbo].[AspNetUserLogins] (
    [LoginProvider] NVARCHAR (128) NOT NULL,
    [ProviderKey]   NVARCHAR (128) NOT NULL,
    [UserId]        NVARCHAR (128) NOT NULL,
    CONSTRAINT [PK_AspNetUserLogins] PRIMARY KEY CLUSTERED ([LoginProvider] ASC, [ProviderKey] ASC, [UserId] ASC)
);


GO
PRINT N'Creating [dbo].[AspNetUserLogins].[IX_FK_dbo_AspNetUserLogins_dbo_AspNetUsers_UserId]...';


GO
CREATE NONCLUSTERED INDEX [IX_FK_dbo_AspNetUserLogins_dbo_AspNetUsers_UserId]
    ON [dbo].[AspNetUserLogins]([UserId] ASC);


GO
PRINT N'Creating [dbo].[AspNetUserRoles]...';


GO
CREATE TABLE [dbo].[AspNetUserRoles] (
    [RoleId] NVARCHAR (128) NOT NULL,
    [UserId] NVARCHAR (128) NOT NULL,
    CONSTRAINT [PK_AspNetUserRoles] PRIMARY KEY CLUSTERED ([RoleId] ASC, [UserId] ASC)
);


GO
PRINT N'Creating [dbo].[AspNetUserRoles].[IX_FK_AspNetUserRoles_AspNetUser]...';


GO
CREATE NONCLUSTERED INDEX [IX_FK_AspNetUserRoles_AspNetUser]
    ON [dbo].[AspNetUserRoles]([UserId] ASC);


GO
PRINT N'Creating [dbo].[AspNetUsers]...';


GO
CREATE TABLE [dbo].[AspNetUsers] (
    [Id]                   NVARCHAR (128) NOT NULL,
    [Email]                NVARCHAR (256) NOT NULL,
    [EmailConfirmed]       BIT            NOT NULL,
    [PasswordHash]         NVARCHAR (MAX) NULL,
    [SecurityStamp]        NVARCHAR (MAX) NULL,
    [PhoneNumber]          NVARCHAR (MAX) NULL,
    [PhoneNumberConfirmed] BIT            NOT NULL,
    [TwoFactorEnabled]     BIT            NOT NULL,
    [LockoutEndDateUtc]    DATETIME       NULL,
    [LockoutEnabled]       BIT            NOT NULL,
    [AccessFailedCount]    INT            NOT NULL,
    [UserName]             NVARCHAR (256) NOT NULL,
    CONSTRAINT [PK_AspNetUsers] PRIMARY KEY CLUSTERED ([Id] ASC)
);


GO
PRINT N'Creating [dbo].[Comments]...';


GO
CREATE TABLE [dbo].[Comments] (
    [CommentID]          BIGINT         IDENTITY (1, 1) NOT NULL,
    [Description]        NVARCHAR (MAX) NOT NULL,
    [CreatedTime]        DATETIME       NOT NULL,
    [AspNetUserID]       NVARCHAR (128) NOT NULL,
    [NaturalTreatmentID] BIGINT         NOT NULL,
    [CommentCommentID]   BIGINT         NULL,
    [VoteUp]             INT            NOT NULL,
    [VoteDown]           INT            NOT NULL,
    CONSTRAINT [PK_Comments] PRIMARY KEY CLUSTERED ([CommentID] ASC)
);


GO
PRINT N'Creating [dbo].[Comments].[IX_FK_AspNetUserComment]...';


GO
CREATE NONCLUSTERED INDEX [IX_FK_AspNetUserComment]
    ON [dbo].[Comments]([AspNetUserID] ASC);


GO
PRINT N'Creating [dbo].[Comments].[IX_FK_NaturalTreatmentComment]...';


GO
CREATE NONCLUSTERED INDEX [IX_FK_NaturalTreatmentComment]
    ON [dbo].[Comments]([NaturalTreatmentID] ASC);


GO
PRINT N'Creating [dbo].[Comments].[IX_FK_CommentComment]...';


GO
CREATE NONCLUSTERED INDEX [IX_FK_CommentComment]
    ON [dbo].[Comments]([CommentCommentID] ASC);


GO
PRINT N'Creating [dbo].[Diseases]...';


GO
CREATE TABLE [dbo].[Diseases] (
    [DiseaseID]   BIGINT          IDENTITY (1, 1) NOT NULL,
    [Name]        NVARCHAR (50)   NOT NULL,
    [Description] NVARCHAR (1000) NULL,
    [URLwiki]     NVARCHAR (500)  NULL,
    CONSTRAINT [PK_Disease] PRIMARY KEY CLUSTERED ([DiseaseID] ASC)
);


GO
PRINT N'Creating [dbo].[NaturalTreatments]...';


GO
CREATE TABLE [dbo].[NaturalTreatments] (
    [NaturalTreatmentID] BIGINT         IDENTITY (1, 1) NOT NULL,
    [Name]               NVARCHAR (50)  NOT NULL,
    [ScoreUsers]         DECIMAL (4, 2) NULL,
    [ScoreEntities]      DECIMAL (4, 2) NULL,
    [Description]        NVARCHAR (MAX) NULL,
    [DiseaseID]          BIGINT         NOT NULL,
    [Treatment]          BIT            NOT NULL,
    [Prevention]         BIT            NOT NULL,
    [Approved]           BIT            NOT NULL,
    [AspNetUserID]       NVARCHAR (128) NOT NULL,
    CONSTRAINT [PK_NaturalTreatment] PRIMARY KEY CLUSTERED ([NaturalTreatmentID] ASC)
);


GO
PRINT N'Creating [dbo].[NaturalTreatments].[IX_FK_NaturalTreatment_Disease]...';


GO
CREATE NONCLUSTERED INDEX [IX_FK_NaturalTreatment_Disease]
    ON [dbo].[NaturalTreatments]([DiseaseID] ASC);


GO
PRINT N'Creating [dbo].[NaturalTreatments].[IX_FK_NaturalTreatment_AspNetUsers]...';


GO
CREATE NONCLUSTERED INDEX [IX_FK_NaturalTreatment_AspNetUsers]
    ON [dbo].[NaturalTreatments]([AspNetUserID] ASC);


GO
PRINT N'Creating [dbo].[Test]...';


GO
CREATE TABLE [dbo].[Test] (
    [test] NCHAR (10) NULL
);


GO
PRINT N'Creating [dbo].[DF_AspNetUserComments_Checked]...';


GO
ALTER TABLE [dbo].[AspNetUserComments]
    ADD CONSTRAINT [DF_AspNetUserComments_Checked] DEFAULT ((0)) FOR [CheckedUp];


GO
PRINT N'Creating [dbo].[DF_Comments]...';


GO
ALTER TABLE [dbo].[Comments]
    ADD CONSTRAINT [DF_Comments] DEFAULT (getutcdate()) FOR [CreatedTime];


GO
PRINT N'Creating unnamed constraint on [dbo].[Comments]...';


GO
ALTER TABLE [dbo].[Comments]
    ADD DEFAULT ((0)) FOR [VoteUp];


GO
PRINT N'Creating unnamed constraint on [dbo].[Comments]...';


GO
ALTER TABLE [dbo].[Comments]
    ADD DEFAULT ((0)) FOR [VoteDown];


GO
PRINT N'Creating [dbo].[FK_dbo_AspNetUserClaims_dbo_AspNetUsers_UserId]...';


GO
ALTER TABLE [dbo].[AspNetUserClaims] WITH NOCHECK
    ADD CONSTRAINT [FK_dbo_AspNetUserClaims_dbo_AspNetUsers_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[AspNetUsers] ([Id]) ON DELETE CASCADE;


GO
PRINT N'Creating [dbo].[FK_AspNetUserComments_AspNetUsers]...';


GO
ALTER TABLE [dbo].[AspNetUserComments] WITH NOCHECK
    ADD CONSTRAINT [FK_AspNetUserComments_AspNetUsers] FOREIGN KEY ([AspNetUserID]) REFERENCES [dbo].[AspNetUsers] ([Id]);


GO
PRINT N'Creating [dbo].[FK_AspNetUserComments_Comments]...';


GO
ALTER TABLE [dbo].[AspNetUserComments] WITH NOCHECK
    ADD CONSTRAINT [FK_AspNetUserComments_Comments] FOREIGN KEY ([CommentID]) REFERENCES [dbo].[Comments] ([CommentID]);


GO
PRINT N'Creating [dbo].[FK_AspNetUserComments_NaturalTreatment]...';


GO
ALTER TABLE [dbo].[AspNetUserComments] WITH NOCHECK
    ADD CONSTRAINT [FK_AspNetUserComments_NaturalTreatment] FOREIGN KEY ([NaturalTreatmentID]) REFERENCES [dbo].[NaturalTreatments] ([NaturalTreatmentID]);


GO
PRINT N'Creating [dbo].[FK_dbo_AspNetUserLogins_dbo_AspNetUsers_UserId]...';


GO
ALTER TABLE [dbo].[AspNetUserLogins] WITH NOCHECK
    ADD CONSTRAINT [FK_dbo_AspNetUserLogins_dbo_AspNetUsers_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[AspNetUsers] ([Id]) ON DELETE CASCADE;


GO
PRINT N'Creating [dbo].[FK_AspNetUserRoles_AspNetRole]...';


GO
ALTER TABLE [dbo].[AspNetUserRoles] WITH NOCHECK
    ADD CONSTRAINT [FK_AspNetUserRoles_AspNetRole] FOREIGN KEY ([RoleId]) REFERENCES [dbo].[AspNetRoles] ([Id]);


GO
PRINT N'Creating [dbo].[FK_AspNetUserRoles_AspNetUser]...';


GO
ALTER TABLE [dbo].[AspNetUserRoles] WITH NOCHECK
    ADD CONSTRAINT [FK_AspNetUserRoles_AspNetUser] FOREIGN KEY ([UserId]) REFERENCES [dbo].[AspNetUsers] ([Id]);


GO
PRINT N'Creating [dbo].[FK_AspNetUserComment]...';


GO
ALTER TABLE [dbo].[Comments] WITH NOCHECK
    ADD CONSTRAINT [FK_AspNetUserComment] FOREIGN KEY ([AspNetUserID]) REFERENCES [dbo].[AspNetUsers] ([Id]);


GO
PRINT N'Creating [dbo].[FK_CommentComment]...';


GO
ALTER TABLE [dbo].[Comments] WITH NOCHECK
    ADD CONSTRAINT [FK_CommentComment] FOREIGN KEY ([CommentCommentID]) REFERENCES [dbo].[Comments] ([CommentID]);


GO
PRINT N'Creating [dbo].[FK_NaturalTreatmentComment]...';


GO
ALTER TABLE [dbo].[Comments] WITH NOCHECK
    ADD CONSTRAINT [FK_NaturalTreatmentComment] FOREIGN KEY ([NaturalTreatmentID]) REFERENCES [dbo].[NaturalTreatments] ([NaturalTreatmentID]);


GO
PRINT N'Creating [dbo].[FK_NaturalTreatment_AspNetUsers]...';


GO
ALTER TABLE [dbo].[NaturalTreatments] WITH NOCHECK
    ADD CONSTRAINT [FK_NaturalTreatment_AspNetUsers] FOREIGN KEY ([AspNetUserID]) REFERENCES [dbo].[AspNetUsers] ([Id]) ON DELETE CASCADE;


GO
PRINT N'Creating [dbo].[FK_NaturalTreatment_Disease]...';


GO
ALTER TABLE [dbo].[NaturalTreatments] WITH NOCHECK
    ADD CONSTRAINT [FK_NaturalTreatment_Disease] FOREIGN KEY ([DiseaseID]) REFERENCES [dbo].[Diseases] ([DiseaseID]) ON DELETE CASCADE;


GO
PRINT N'Creating [dbo].[spAddRole]...';


GO


-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[spAddRole]
  --@Id NVARCHAR(128),
  @Name nvarchar(256)
AS
BEGIN
	INSERT INTO [AspNetRoles] (Id,Name)
	VALUES (
			CASE (select max(cast(Id as bigint)) from [dbo].[AspNetRoles])
				WHEN NULL THEN '1'
				ELSE (select cast(max(cast(Id as bigint)+1) as nvarchar) from [dbo].[AspNetRoles])
			END
			--@Id
			,@Name)
	
END
GO
PRINT N'Creating [dbo].[spGetAllRoles]...';


GO

-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[spGetAllRoles]
AS
BEGIN
	SELECT Id,Name
	FROM [AspNetRoles]
END
GO
